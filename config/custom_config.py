import cv2
import os
import mediapipe as mp
from mediapipe.tasks import python
from mediapipe.tasks.python import vision
from mediapipe import solutions
from mediapipe.framework.formats import landmark_pb2
import numpy as np


IP_WEBCAM_URL = "http://192.168.2.2:8080/video"

POSE_CLASSIFICATION_FRAME_INTERVAL = 30

HUMAN_POSE_STANDARD_EMBEDDINGS = {
    # attack.png
    "attack": [
        0.05167024064490181,
        0.8659931109591512,
        0.10588508214038375,
        0.8943200661859051,
        0.11309547727256124,
        0.8943278435147907,
        0.10546948394404972,
        0.8936624219455147,
        0.05203647213996975,
        0.9139917742621092,
        0.05306676860103116,
        0.9090085134990595,
        0.06325252461532727,
        0.8914284051299262,
        0.28912804859430236,
        0.8796359674867511,
        0.17129311895231958,
        0.8388288245871973,
        0.15845533283541632,
        0.8467172103841891,
        0.04200991246832523,
        0.8049731920490946,
        0.5944497801615851,
        0.6753124500066191,
        0.4287436052609815,
        0.7435470958659482,
        1.0,
        0.6416498290283866,
        0.6668432535749496,
        0.3538120577532735,
        0.8654321209672329,
        0.8925950880899575,
        1.0,
        0.06715561987694593,
        0.7892283391582879,
        0.9703071618411129,
        0.9719564849250222,
        0.005384708853079818,
        0.7189784871003341,
        1.0,
        0.8219613421042613,
        0.015592312221202621,
        0.8506951449719655,
        0.8984291719076525,
        0.9628738879356857,
        0.055373243630346736,
        0.2549588216263828,
        0.010812586162226539,
        0.34425973306518204,
        0.017858181850340275,
        0.34457795913596223,
        0.5102823276867112,
        0.36852652873152797,
        0.39366127134614143,
        0.4560353610994187,
        0.9116794671099413,
        0.600150506918855,
        0.8456845549777507,
        0.40465788436973316,
        0.9479135957084394,
        0.6241638759765228,
        0.884568257833913,
        0.5281958619687129,
        1.0,
        0.8524627867868971,
        0.9198925469962304,
    ],
    # press key E to enhance the character
    "enhance": [
        0.0863276917646899,
        0.8741092612111858,
        0.18451458979562746,
        0.9035083946816758,
        0.1884797969171039,
        0.9060400143903679,
        0.18571381058718922,
        0.9074047987979528,
        0.06852705085217438,
        0.9251246774635629,
        0.0699399727820049,
        0.9224394025507966,
        0.08740550061427146,
        0.9026577114010187,
        0.4789253303830203,
        0.9055841992319128,
        0.1981097005644351,
        0.8501348431716872,
        0.2642187553027578,
        0.8684205850245922,
        0.07931908347983085,
        0.8210373546102012,
        0.849159432290995,
        0.6545168320691974,
        0.4797914479877464,
        0.8018670223226675,
        0.9582331380787218,
        0.3147382852714448,
        0.9614925817885471,
        0.6144360008477647,
        1.0,
        0.04513280344697785,
        0.8196755878485702,
        0.8492273332177915,
        0.9561053831900034,
        0.10872021233926266,
        0.6626137539026337,
        0.9190294587928933,
        0.8409391905191782,
        0.13602284688881924,
        0.5506077488277825,
        1.0,
        0.9635547651854014,
        0.09129506451372986,
        0.7844901859654718,
        0.8920754174077955,
        0.39203615717204354,
        0.007520972955106133,
        0.37508942520801397,
        0.01357583295284356,
        0.45174093355686934,
        0.5176074954118047,
        0.508450438652057,
        0.40548170856118293,
        0.6125929043161903,
        0.9080844819698627,
        0.7503604885474605,
        0.8461903753953939,
        0.5358634756225862,
        0.9504805298041251,
        0.782260954075781,
        0.8859273734407349,
        0.7508417215890966,
        1.0,
        1.0,
        0.9178649717821492,
    ],
    # back.png
    "step_back": [
        0.03943217502653099,
        0.822098840129783,
        0.02198946600840615,
        0.8431246210728944,
        0.03067802249336807,
        0.8467647855402534,
        0.024843255539008673,
        0.8462504496300038,
        0.05550823842736467,
        0.8605924820092168,
        0.04999868779641718,
        0.8562145816502289,
        0.041723121911583436,
        0.8388288881665545,
        0.28460900199175276,
        0.8098200039936309,
        0.25191971304095034,
        0.7537150354194087,
        0.10096956383398707,
        0.8004759397603991,
        0.0438816375784782,
        0.7546864133460274,
        0.6227076325502833,
        0.6231066351026596,
        0.49436686927335666,
        0.7144427664418266,
        1.0,
        0.8200337186886753,
        1.0,
        0.7855725196306669,
        0.6683238008678658,
        0.9218328008620574,
        0.7411576957568206,
        0.9251315122037919,
        0.5132211023878911,
        0.9379028910083009,
        0.5271100470519089,
        0.9607911085421268,
        0.41415987973542057,
        0.9206241615281205,
        0.3687094381683881,
        1.0,
        0.6368947300821145,
        0.897979058003676,
        0.667905253478774,
        0.9469837421645402,
        0.3074604772392416,
        0.0029711557395120792,
        0.28683622635835576,
        0.00335185432813784,
        0.4000573631843479,
        0.48336580096958054,
        0.29844376603533834,
        0.4049036645253336,
        0.511179437477596,
        0.9578536218748352,
        0.3680102718822648,
        0.9286207086248168,
        0.4384313744480912,
        0.9969215648287935,
        0.3777078380433852,
        0.9734686574894974,
        0.5190268685765643,
        1.0,
        0.5355088343810079,
        0.9667958426525026,
    ],
    # escape.png
    "escape": [
        0.0963546688550843,
        0.8629020459211365,
        0.024876243980456365,
        0.8778806899969323,
        0.017225870101663862,
        0.8815382558148681,
        0.03047100403476583,
        0.8805192281976858,
        0.14283876603670084,
        0.8910213873878126,
        0.12591056610114632,
        0.888054762410427,
        0.10409428694437745,
        0.8721134105764919,
        0.34985555444139016,
        0.8493585356836649,
        0.4093667137296337,
        0.7791410434905727,
        0.15663794364385675,
        0.8405036537115259,
        0.059789784380510184,
        0.7950654836349906,
        1.0,
        0.6337844034893142,
        0.7147056166974529,
        0.7247026295710723,
        0.49689650264402496,
        0.6577324570718392,
        0.6327487769725884,
        0.6642869166450355,
        0.47761537919378677,
        0.8387947864800874,
        0.1987789305476252,
        0.8901323831323595,
        0.8304876980049808,
        0.8777914120080862,
        0.6235334280005602,
        0.9371211584900614,
        0.8738542999161465,
        0.8964462640897971,
        0.7690742411221505,
        1.0,
        0.48886496814207103,
        0.8329232051977881,
        0.27784510824300995,
        0.9227810683468234,
        0.5623378302337897,
        9.157799705618614e-05,
        0.5550751943026734,
        0.009245003677309233,
        0.4364121003610725,
        0.4916947733113069,
        0.42456702380369227,
        0.41670879078331496,
        0.7386328368759649,
        0.9386586103845448,
        0.8043966360209657,
        0.9013970866602423,
        0.6063387194482727,
        0.9777170951495961,
        0.8330450029029397,
        0.9400246506745594,
        0.6562021156343464,
        1.0,
        1.0,
        0.9273732906571219,
    ],
    # forward.png
    "forward": [
        0.039529853929853746,
        0.8523757102001875,
        0.12568726904330074,
        0.8728525868111754,
        0.12288806364176597,
        0.8773118693778681,
        0.11765555772179857,
        0.8774229147238174,
        0.0013898123371771513,
        0.8822250108400432,
        0.01475629381162373,
        0.8835672325031204,
        0.029299249774937166,
        0.8670788849242985,
        0.37219630204245485,
        0.8485514528282405,
        0.2764885696758217,
        0.7751731967043644,
        0.1936936326443141,
        0.8329033264970188,
        0.028608136542648026,
        0.7848025668697605,
        0.7265811337544857,
        0.6547451341184201,
        0.49250603970336343,
        0.7278981420571782,
        0.8603137340097633,
        0.7586515519243199,
        0.6071597916345124,
        0.6801043153746874,
        0.9960514364701045,
        0.9161517423990732,
        0.7846141208427813,
        0.8763660976426484,
        1.0,
        0.9480830202562621,
        0.7386335731809232,
        0.924402149162112,
        0.9143917935843021,
        0.9667104259687989,
        0.5371633090736957,
        1.0,
        0.9947381042303781,
        0.9021654416549791,
        0.7372000913467573,
        0.9080662633987404,
        0.3851582882253939,
        0.0026785513784528727,
        0.4469821462301115,
        0.006289702145463334,
        0.4015201270190316,
        0.49295720019021516,
        0.44694079502722134,
        0.4201772535795095,
        0.4760755413337574,
        0.9567300530105474,
        0.8991924535925281,
        0.9193167965862273,
        0.39480020022242923,
        1.0,
        0.9325943553657902,
        0.9599318676293386,
        0.643310997382237,
        0.9894455144435856,
        1.0,
        0.9861292340754436,
    ],
    # jump.png
    "jump": [
        0.02431205849863374,
        0.9390606763374468,
        0.08822705368341942,
        0.977346031118721,
        0.08911783746017203,
        0.9776292550266795,
        0.08321047554266295,
        0.9788033525242007,
        0.0018271218227269334,
        1.0,
        0.010140627309729514,
        0.9964366094247866,
        0.01795230403980382,
        0.9769624490139885,
        0.279451772664804,
        0.9685052731123267,
        0.20847146513624018,
        0.9027077617050141,
        0.12564133870641975,
        0.9187939248731201,
        0.0021325435308546933,
        0.8680150643153859,
        0.5487527643574616,
        0.7608286701885094,
        0.41231853259707113,
        0.8723713572932388,
        1.0,
        0.7318514084292167,
        1.0,
        0.7093159078846671,
        0.8497146363488673,
        0.8261546433672364,
        0.8140076590618007,
        0.8294723276023649,
        0.7515082305038705,
        0.8494898959948674,
        0.6729134902113284,
        0.8720451672079644,
        0.644140248239666,
        0.8680829384215804,
        0.48261744465327056,
        0.938390237918461,
        0.816475204573429,
        0.8090157050718563,
        0.738697381617012,
        0.8549734284290382,
        0.26329487168697885,
        0.014372046857616349,
        0.26553823652004455,
        0.032573801285166105,
        0.23458534546601467,
        0.45527218379131534,
        0.031700000157342714,
        0.06130712623267652,
        0.04664949836333939,
        0.9095495189227967,
        0.18440685087334263,
        0.4244499229668176,
        0.05083483778395472,
        0.9520777172666857,
        0.19874097460746093,
        0.445176835499732,
        0.13127994100697238,
        1.0,
        0.22741109350038236,
        0.4794832237209425,
    ],
    # move_left.png
    "move_left": [
        0.026729451052550073,
        0.9519513495426521,
        0.014473574109790268,
        0.9835262055009487,
        0.01584022853934539,
        0.9863640339225651,
        0.011747094070612783,
        0.9858667470890439,
        0.09025673085938349,
        1.0,
        0.07816720925467495,
        0.9983471858700497,
        0.05704496316711885,
        0.9791954278281748,
        0.08555799648417986,
        0.963877523542417,
        0.43569714447067215,
        0.8797686368697404,
        0.04605773165890585,
        0.937628835486882,
        0.05539274624611998,
        0.8813138461493795,
        0.24628213709130045,
        0.740086517565902,
        0.6718759583879124,
        0.819580145108679,
        0.5357018983442174,
        0.7295241851427642,
        1.0,
        0.6578614416074023,
        0.9264317495755221,
        0.7471890274263533,
        0.14000109190462226,
        0.6863806282961924,
        1.0,
        0.7637454762412845,
        0.07075221188550278,
        0.6831676799305523,
        0.9873087541633854,
        0.7673338167385968,
        0.17072857501327637,
        0.7549775862544512,
        0.9546609499055327,
        0.722199751619698,
        0.009705903983255056,
        0.7068370724657879,
        0.13366299456333128,
        0.006541066129985207,
        0.40338300265353866,
        0.000569386789807988,
        0.18273759101205395,
        0.4918391645370229,
        0.27697684421794416,
        0.4090156517000583,
        0.23421119140872498,
        0.9553504690595734,
        0.561566547222225,
        0.8959987269390371,
        0.20342940452489522,
        1.0,
        0.5844234388978824,
        0.9367448197570454,
        0.2958452481295931,
        0.9864829597242535,
        0.6347807395506637,
        0.9403880044391386,
    ],
    # move_right.png
    "move_right": [
        0.02579456174251691,
        0.9555616024013187,
        0.1310343748478497,
        0.9824713882140675,
        0.1420659103081115,
        0.9869941272257174,
        0.13650861118107102,
        0.9866258005666393,
        0.020108756659299336,
        1.0,
        0.028301510315264438,
        0.9974866958030841,
        0.04196679096156586,
        0.9780857723276423,
        0.5062608533881204,
        0.9567059994667537,
        0.09097585230724646,
        0.9080921794637714,
        0.22587626927162008,
        0.931571841919627,
        0.027395697118115517,
        0.8811905745561208,
        0.9037064414351327,
        0.7020477642144156,
        0.21870039625084517,
        0.8514473136696603,
        1.0,
        0.5699016971287626,
        0.568914476635236,
        0.7365230279463437,
        0.0404497585431079,
        0.6243506871402493,
        0.9618694582058356,
        0.7513322789882005,
        0.09355642543218641,
        0.6435548505515976,
        1.0,
        0.768430556573004,
        0.15889854495290617,
        0.6766257410691476,
        0.9519877157014313,
        0.8053055214787804,
        0.021560531464320278,
        0.6172825710651055,
        0.9667042090892636,
        0.7622040511098327,
        0.447280071060577,
        0.0036830196516718997,
        0.16239297968053285,
        0.01301998018733529,
        0.48567427904049587,
        0.4912992137961547,
        0.13124288982173368,
        0.41371243134843466,
        0.6979219950578577,
        0.9562999069021658,
        0.22257750875024615,
        0.9119650057864371,
        0.6146461156817145,
        0.9994630665350109,
        0.22951845654084163,
        0.9512454640100402,
        0.8125103311932611,
        1.0,
        0.2477994644129403,
        0.974780921372595,
    ],
    # small_skill.png
    "E": [
        0.048104134510469514,
        0.9515680268294437,
        0.028777257030294733,
        0.9784623657811501,
        0.03723153159476894,
        0.9812514385589003,
        0.026930362668871884,
        0.9802580857683759,
        0.08291189041808697,
        1.0,
        0.07265471640009928,
        0.9963586551957664,
        0.05909656598277556,
        0.9778158800204401,
        0.27854120511223046,
        0.9427395208870688,
        0.3449790648706273,
        0.8792535565730069,
        0.10438017197064305,
        0.9275074472996458,
        0.060240552728642226,
        0.8744698086216192,
        0.6279531335413763,
        0.6807114132725215,
        0.5971636667215429,
        0.7889232055750716,
        1.0,
        0.5863308014696688,
        1.0,
        0.5767896336852667,
        0.5618977674966964,
        0.7258851987777681,
        0.4082219304777098,
        0.719947852299161,
        0.35486289796119824,
        0.7627771070037349,
        0.07629476483878794,
        0.760708475908396,
        0.2566685885490731,
        0.7894555079467275,
        0.08256731593930809,
        0.8342138784382862,
        0.5188561575203223,
        0.721232000343072,
        0.3124092766955282,
        0.7510253260369816,
        0.32101113946789817,
        0.0008714240277950927,
        0.37256145646437405,
        0.007741941828710306,
        0.4777709737785861,
        0.5131556818618294,
        0.30298509094545556,
        0.407564755775521,
        0.7281222033176975,
        0.9609393315407313,
        0.3792337542086839,
        0.8976025123915005,
        0.6740531673460189,
        1.0,
        0.3835821007777656,
        0.9361884473015741,
        0.9108901935804704,
        0.9914110335368185,
        0.5175312035241103,
        0.9349416116795304,
    ],
    # speed_up.png
    "run": [
        0.01984736841973123,
        0.6434059746908521,
        0.09442738307030754,
        0.6604326394290108,
        0.10110288979395629,
        0.6626971201281224,
        0.0937823509848257,
        0.6612087553199684,
        0.01037012010922466,
        0.6698231745402023,
        0.008158192315230704,
        0.6683440916502753,
        0.008469713395067276,
        0.6559554354820933,
        0.4761486676143596,
        0.6445480809203779,
        0.2756103493016821,
        0.5902632431919742,
        0.2477300854346357,
        0.6274663393694283,
        0.028791283308804122,
        0.5910811584497819,
        0.824508591417303,
        0.5371573320177188,
        0.5113576310873484,
        0.5251414893200467,
        0.9114963254721016,
        0.7251140246772397,
        0.7033026669693094,
        0.3157021964768174,
        0.9809621175564386,
        0.9299777621221391,
        0.6616638653648388,
        0.3399978940495466,
        0.9315849218739146,
        0.9841732229690717,
        0.4614660567858926,
        0.357812138769718,
        0.8582393130548468,
        1.0,
        0.3332692480419318,
        0.4153828062853216,
        1.0,
        0.9270019545506879,
        0.5947225283849392,
        0.367428236787758,
        0.46933383981846877,
        0.006456452429321399,
        0.4737411461339598,
        0.008657349052497484,
        0.5164875891893376,
        0.5001708990813798,
        0.6326181716527286,
        0.382925049299261,
        0.5186316565930356,
        0.9261037797481575,
        0.6718096926203684,
        0.8657663821613911,
        0.4013871683848832,
        0.9652411764306958,
        0.6686039194784704,
        0.9088954177495424,
        0.3912544528763786,
        1.0,
        1.0,
        0.9257830048850915,
    ],
    # ultra_skill.png
    "R": [
        0.26716521636011625,
        0.1681624211542161,
        0.28569859125826164,
        0.428044927336428,
        0.2835755832112268,
        0.388125093398448,
        0.2817528839058708,
        0.40566805533884537,
        0.2459132975074796,
        0.40157578194475874,
        0.24784350312836687,
        0.3572824952418516,
        0.242047854266154,
        0.2870753907225879,
        0.33799802170531934,
        0.762475694536259,
        0.05670573927559434,
        0.5650410139036101,
        0.31602469259192495,
        0.13922658111923922,
        0.21814719496018722,
        0.012367177854584906,
        0.4702859682866037,
        1.0,
        0.06376872697054589,
        0.9124080170368188,
        0.6493493996403137,
        0.04732792502779764,
        0.23511735647703774,
        0.210529148211599,
        0.6115582402140747,
        0.2823134963742552,
        0.1341769542551084,
        0.33568518399381836,
        0.6221874592854224,
        0.31818897346554664,
        0.20754045876368085,
        0.39108776902093934,
        0.5382530127052287,
        0.30112578907520765,
        0.34515146764835775,
        0.3595205755123785,
        0.5554967580041513,
        0.31487056721209,
        0.1892646825814683,
        0.3361989560743825,
        0.16600561561234625,
        0.24937945751557336,
        0.6591716285547805,
        0.04150043447233392,
        0.6887788095607793,
        0.24679424364913988,
        0.081300876490042,
        0.41871090121499743,
        0.7834611114184845,
        0.7993802743425024,
        0.9281461386296493,
        0.8885966306964126,
        0.7868308655217703,
        0.8323143640918477,
        1.0,
        0.928748728443134,
        1.0,
        0.8590504084320413,
        0.7436255564760876,
        1.0,
    ],
    # stop
    "stop": [
        0.08860187570922261,
        0.9516778979617824,
        0.19096663484614348,
        0.9824733805978219,
        0.20072617164166334,
        0.9813706430810238,
        0.19616027978194409,
        0.9814920716386013,
        0.0771475076353862,
        1.0,
        0.07931454540624937,
        0.9966627000004524,
        0.10063851425053719,
        0.9761634356358927,
        0.5063681021892009,
        0.9622542791562202,
        0.2660948058795313,
        0.9067161812002184,
        0.27309011169784053,
        0.9361445537260422,
        0.07588387511395711,
        0.8864769493969803,
        0.884494293176635,
        0.6941860560678589,
        0.6188498255219056,
        0.7886810670162824,
        1.0,
        0.3679828260312909,
        0.8294172581120763,
        0.3143186985296433,
        0.9271017422148129,
        0.0012644778672334458,
        1.0,
        0.0002892928881923562,
        0.8635453007855657,
        0.06818134236050619,
        0.9092352111470304,
        0.05973989621993259,
        0.7002478793219128,
        0.08467912908017777,
        0.7133210424114939,
        0.035885251710408995,
        0.873500711719592,
        0.044182298187018625,
        0.9131713296073292,
        0.006330725913377575,
        0.44488234556658585,
        0.00888644925748702,
        0.5101263794164768,
        0.014434368176280653,
        0.36327738119266034,
        0.5162647711797682,
        0.4627017402966943,
        0.40236814163348594,
        0.34772530036600163,
        0.9034974075184683,
        0.7865419671453944,
        0.84240818181324,
        0.25007548215682,
        0.9441109436056848,
        0.8168293396330253,
        0.8811267403256311,
        0.29576753271329015,
        1.0,
        0.9181315216962966,
        0.9219830621503573,
    ],
    "turn_on_left": [
        0.06303489322538379,
        0.9570770281742556,
        0.08610507271812855,
        0.9831569914194307,
        0.0837479787248357,
        0.9863916155377892,
        0.0811316559479605,
        0.9868268836224212,
        0.04598467423928193,
        1.0,
        0.046725561657082915,
        0.9989945229841072,
        0.05336640550972503,
        0.9786287756668198,
        0.12704650453953245,
        0.974845959734305,
        0.28491728360839463,
        0.9057085998429388,
        0.10490097555534364,
        0.9425526972387525,
        0.04381950327235966,
        0.8935197174034216,
        0.2710488311998301,
        0.792377897669772,
        0.5681470723556511,
        0.8483022351588075,
        0.5738145703810352,
        0.7924503993483621,
        0.5854136877171939,
        0.6382924796838342,
        0.9194776822165422,
        0.8040338970718697,
        0.6939927679814042,
        0.7137269070758112,
        1.0,
        0.8300771364537494,
        0.6358164790594464,
        0.7506213170243832,
        0.9935852546172925,
        0.8343740004680358,
        0.4931094721885993,
        0.8227402761961337,
        0.9489364270446422,
        0.7779341528230459,
        0.666045073125705,
        0.7445530211311862,
        0.13188442615773824,
        0.005741490733631843,
        0.41636775786271696,
        0.0003308120156993785,
        0.132470052365945,
        0.5003262954397646,
        0.3437687414388749,
        0.41541144099237853,
        0.1345350340711134,
        0.908221186944671,
        0.8017145230873852,
        0.8677002182593618,
        0.09603696973703532,
        0.9499897558408446,
        0.8446160870666717,
        0.9057651181693889,
        0.12445858004493413,
        1.0,
        1.0,
        0.9353784751840638,
    ],
    "turn_on_right": [
        0.06952834299795115,
        0.9605819135673621,
        0.04199331495282386,
        0.9940686364484551,
        0.03894174831253895,
        0.9968729024052484,
        0.04013809075807718,
        0.9988421372370268,
        0.07968210289746833,
        1.0,
        0.0755267985304721,
        0.9987800322144762,
        0.06877070692617032,
        0.978069199686632,
        0.4168104676723057,
        0.9920897662752365,
        0.14135366691457435,
        0.8877206063892427,
        0.02886223582615473,
        0.9418968877274752,
        0.05358485954353949,
        0.8788130671257033,
        1.0,
        0.7529778929015581,
        0.21352050167856063,
        0.8275228090473757,
        0.8577408346766211,
        0.7589160775116474,
        0.5226427187322359,
        0.7237044854136194,
        0.5718238401769705,
        0.9180912980083272,
        0.9478524361135638,
        0.7576178822015591,
        0.5315558633858178,
        0.9605206671395934,
        1.0,
        0.7637899384902699,
        0.4361051224385153,
        0.9857431290475589,
        0.9921030774328762,
        0.821036697867365,
        0.5721654131049505,
        0.911618256548884,
        0.9670515234585743,
        0.7753289753606194,
        0.5929414576373583,
        0.0002853663359543813,
        0.13515711589599458,
        0.009964029708238046,
        0.6747180657156544,
        0.46175485422722734,
        0.07903089287062623,
        0.37913036049607174,
        0.8615616841257638,
        0.9510473032144258,
        0.21838482601536194,
        0.8988203799865357,
        0.732244921581351,
        1.0,
        0.23205210638721563,
        0.9411636028035395,
        0.6819432985816839,
        0.9914260429410315,
        0.28116807456322407,
        0.9520244981510612,
    ],
}


if __name__ == "__main__":
    # image_path = "E:/mingchao_data/human_pose_test/test/forward1.png"
    # image_path = "E:/mingchao_data/human_pose_test/test/slow_right0.png"
    image_path = "E:/mingchao_data/human_pose_test/test/jump0.png"

    model_path = "E:/python_projects/MingchaoPlayer/models/mediapipe_models/pose_landmarker_heavy.task"

    flatten_coords0 = []

    # STEP 2: Create an PoseLandmarker object.
    base_options = python.BaseOptions(model_asset_path=model_path)
    options = vision.PoseLandmarkerOptions(
        base_options=base_options, output_segmentation_masks=True
    )
    detector = vision.PoseLandmarker.create_from_options(options)

    # STEP 3: Load the input image.
    image = mp.Image.create_from_file(image_path)

    # STEP 4: Detect pose landmarks from the input image.
    detection_result = detector.detect(image)

    # print(f"pose result: {detection_result}")

    # 归一化worldLandmarks
    worldLandmarks = detection_result.pose_world_landmarks[0]
    max_x = 0
    min_x = 0
    max_y = 0
    min_y = 0
    for landmark in worldLandmarks:
        if landmark.x > max_x:
            max_x = landmark.x
        if landmark.x < min_x:
            min_x = landmark.x
        if landmark.y > max_y:
            max_y = landmark.y
        if landmark.y < min_y:
            min_y = landmark.y
    for landmark in worldLandmarks:
        if landmark.x > 0:
            temp_x = landmark.x / max_x
        elif landmark.x < 0:
            temp_x = landmark.x / min_x
        else:
            temp_x = 0
        if landmark.y > 0:
            temp_y = landmark.y / max_y
        elif landmark.y < 0:
            temp_y = landmark.y / min_y
        else:
            temp_y = 0
        # print(f"{temp_x}   {temp_y}")
        flatten_coords0.append(temp_x)
        flatten_coords0.append(temp_y)

    # 计算相似度
    min_L2_distance = 100000
    current_action = ""
    for key, value in HUMAN_POSE_STANDARD_EMBEDDINGS.items():
        L2_distance_temp = 0
        for i in range(len(flatten_coords0)):
            L2_distance_temp += (flatten_coords0[i] - value[i]) ** 2
        if L2_distance_temp < min_L2_distance:
            min_L2_distance = L2_distance_temp
            current_action = key

    print(f"current_action: {current_action}, L2_distance: {min_L2_distance}")
