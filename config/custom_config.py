import cv2
import os
import mediapipe as mp
from mediapipe.tasks import python
from mediapipe.tasks.python import vision
from mediapipe import solutions
from mediapipe.framework.formats import landmark_pb2
import numpy as np


IP_WEBCAM_URL = "http://192.168.2.3:8080/video"

POSE_CLASSIFICATION_FRAME_INTERVAL = 30

HUMAN_POSE_STANDARD_EMBEDDINGS = {
    # attack.png
    "normal_attack": [
        0.2610978759098757,
        0.9515787444460035,
        0.35880559582888905,
        0.9772128715637356,
        0.3817623007534484,
        0.9800650804153835,
        0.36011854198468407,
        0.979009212479184,
        0.22499723231716795,
        1.0,
        0.23153040086692342,
        0.9961866944111223,
        0.24871965395448653,
        0.9799226092101077,
        0.6425704747853449,
        0.9488620000190441,
        0.18850686633474895,
        0.8995818748599766,
        0.45487559265669875,
        0.933376475937907,
        0.190768580199997,
        0.8823650471601249,
        0.9176774031470682,
        0.7048384245379612,
        0.5305855741240835,
        0.787877802465201,
        0.68586272931849,
        0.6246691766511793,
        1.0,
        0.43617963732544357,
        0.8182536666475058,
        0.7424884168035534,
        0.5632026114674227,
        0.5885948566277946,
        0.7060847507062914,
        0.7791285792746258,
        0.29947779943858044,
        0.6368669486027492,
        0.6942593467842719,
        0.7913331334304821,
        0.18436594597504904,
        0.7275347792334115,
        0.854529579078021,
        0.730498108438733,
        0.4990722378809813,
        0.636090049347498,
        0.5520368548903891,
        0.0038132946260130093,
        0.3425343385063266,
        0.01123825707365941,
        0.5469327687260356,
        0.5022366285817979,
        0.2262194040403516,
        0.4218344103128833,
        0.6545806215364046,
        0.9441237292190228,
        0.43303195270541545,
        0.8824971338361411,
        0.509421831056382,
        0.9859055943207808,
        0.46012163635414527,
        0.9232038095918271,
        1.0,
        1.0,
        0.5515316735261233,
        0.9331919380503143,
    ],
    # back.png
    "step_back": [
        0.0638891152440936,
        0.9492077792381397,
        0.03407206448104875,
        0.9758273822805175,
        0.021362940822515195,
        0.9805553096396841,
        0.02902879658117784,
        0.9798755136025304,
        0.0687345668503113,
        1.0,
        0.06077898375028489,
        0.9956592399183284,
        0.04841506678632277,
        0.9775349842589361,
        0.06884285832702906,
        0.9505912062353761,
        0.2791892884242733,
        0.8955759979521996,
        0.01458756632864409,
        0.9346149978949156,
        0.08177872110211243,
        0.8786055328266977,
        0.43215136828100814,
        0.6549222420690796,
        0.6204066086770986,
        0.8403597951718859,
        0.7707995389936033,
        0.4172871090722126,
        1.0,
        0.47581361210445544,
        0.9790209981140151,
        0.519043051879614,
        0.785810020035686,
        0.355138924552254,
        0.978826928094382,
        0.571570014385077,
        0.6057156522287303,
        0.33056662121340186,
        0.9483466861588541,
        0.608948631534925,
        0.44450544029068295,
        0.41030087283888356,
        1.0,
        0.5200342541892381,
        0.7024303731975947,
        0.38001409665441804,
        0.3350698340816005,
        0.003791911761942854,
        0.3115747621197136,
        0.011704344518087903,
        0.6816535792267101,
        0.4653685166276929,
        0.42178097071559845,
        0.3955523224349902,
        0.48144916681492217,
        0.9118833312039596,
        0.5065721604111458,
        0.893146364252987,
        0.3766838468325578,
        0.9536244879055201,
        0.5152789236094932,
        0.937869042181477,
        0.5179857148302149,
        1.0,
        0.7327817598724193,
        0.955799258612708,
    ],
    # escape.png
    "escape": [
        0.0963546688550843,
        0.8629020459211365,
        0.024876243980456365,
        0.8778806899969323,
        0.017225870101663862,
        0.8815382558148681,
        0.03047100403476583,
        0.8805192281976858,
        0.14283876603670084,
        0.8910213873878126,
        0.12591056610114632,
        0.888054762410427,
        0.10409428694437745,
        0.8721134105764919,
        0.34985555444139016,
        0.8493585356836649,
        0.4093667137296337,
        0.7791410434905727,
        0.15663794364385675,
        0.8405036537115259,
        0.059789784380510184,
        0.7950654836349906,
        1.0,
        0.6337844034893142,
        0.7147056166974529,
        0.7247026295710723,
        0.49689650264402496,
        0.6577324570718392,
        0.6327487769725884,
        0.6642869166450355,
        0.47761537919378677,
        0.8387947864800874,
        0.1987789305476252,
        0.8901323831323595,
        0.8304876980049808,
        0.8777914120080862,
        0.6235334280005602,
        0.9371211584900614,
        0.8738542999161465,
        0.8964462640897971,
        0.7690742411221505,
        1.0,
        0.48886496814207103,
        0.8329232051977881,
        0.27784510824300995,
        0.9227810683468234,
        0.5623378302337897,
        9.157799705618614e-05,
        0.5550751943026734,
        0.009245003677309233,
        0.4364121003610725,
        0.4916947733113069,
        0.42456702380369227,
        0.41670879078331496,
        0.7386328368759649,
        0.9386586103845448,
        0.8043966360209657,
        0.9013970866602423,
        0.6063387194482727,
        0.9777170951495961,
        0.8330450029029397,
        0.9400246506745594,
        0.6562021156343464,
        1.0,
        1.0,
        0.9273732906571219,
    ],
    # forward.png
    "forward": [
        0.15605990711755,
        0.9487926323653537,
        0.07489779025860249,
        0.9821772723381955,
        0.06084338704092824,
        0.984331023245901,
        0.0677037229243457,
        0.9843168328864128,
        0.16566157976617715,
        1.0,
        0.1608671539243097,
        0.9975598949149301,
        0.1446542947456879,
        0.9794283450065717,
        0.17270756862290632,
        0.9605720861620435,
        0.3939218596725996,
        0.8988746772034331,
        0.002025723833895435,
        0.9356835600773884,
        0.1530020517959412,
        0.8822080090207024,
        0.5317223959244876,
        0.7052440837344005,
        0.6697386308319699,
        0.7795388478828938,
        0.806717547502708,
        0.41008542505448053,
        1.0,
        0.38937122971927013,
        0.9897366006177599,
        0.09797984996241829,
        0.8859450117173842,
        0.4086962707280446,
        1.0,
        0.0325658232559798,
        0.7138987018244753,
        0.42187229240436447,
        0.9337169302158376,
        0.014892070206530677,
        0.5975050307700004,
        0.5143369477209874,
        0.9902536079353291,
        0.04907440196503732,
        0.8223142317882846,
        0.4474230352651355,
        0.35187625053805655,
        0.007796002143653921,
        0.360813050398661,
        0.003975801363406781,
        0.505212762938191,
        0.46687844252343363,
        0.22072582620474018,
        0.41173022028468625,
        0.37806112795576347,
        0.8770070173914388,
        0.25686490916732735,
        0.9359614253307879,
        0.27940145050589144,
        0.9169445227754147,
        0.2616359954913098,
        0.9823589655992466,
        0.41535489264884656,
        0.9599415254193611,
        0.4669666972204085,
        1.0,
    ],
    # jump.png
    "jump": [
        0.02431205849863374,
        0.9390606763374468,
        0.08822705368341942,
        0.977346031118721,
        0.08911783746017203,
        0.9776292550266795,
        0.08321047554266295,
        0.9788033525242007,
        0.0018271218227269334,
        1.0,
        0.010140627309729514,
        0.9964366094247866,
        0.01795230403980382,
        0.9769624490139885,
        0.279451772664804,
        0.9685052731123267,
        0.20847146513624018,
        0.9027077617050141,
        0.12564133870641975,
        0.9187939248731201,
        0.0021325435308546933,
        0.8680150643153859,
        0.5487527643574616,
        0.7608286701885094,
        0.41231853259707113,
        0.8723713572932388,
        1.0,
        0.7318514084292167,
        1.0,
        0.7093159078846671,
        0.8497146363488673,
        0.8261546433672364,
        0.8140076590618007,
        0.8294723276023649,
        0.7515082305038705,
        0.8494898959948674,
        0.6729134902113284,
        0.8720451672079644,
        0.644140248239666,
        0.8680829384215804,
        0.48261744465327056,
        0.938390237918461,
        0.816475204573429,
        0.8090157050718563,
        0.738697381617012,
        0.8549734284290382,
        0.26329487168697885,
        0.014372046857616349,
        0.26553823652004455,
        0.032573801285166105,
        0.23458534546601467,
        0.45527218379131534,
        0.031700000157342714,
        0.06130712623267652,
        0.04664949836333939,
        0.9095495189227967,
        0.18440685087334263,
        0.4244499229668176,
        0.05083483778395472,
        0.9520777172666857,
        0.19874097460746093,
        0.445176835499732,
        0.13127994100697238,
        1.0,
        0.22741109350038236,
        0.4794832237209425,
    ],
    # move_left.png
    "move_left": [
        0.026729451052550073,
        0.9519513495426521,
        0.014473574109790268,
        0.9835262055009487,
        0.01584022853934539,
        0.9863640339225651,
        0.011747094070612783,
        0.9858667470890439,
        0.09025673085938349,
        1.0,
        0.07816720925467495,
        0.9983471858700497,
        0.05704496316711885,
        0.9791954278281748,
        0.08555799648417986,
        0.963877523542417,
        0.43569714447067215,
        0.8797686368697404,
        0.04605773165890585,
        0.937628835486882,
        0.05539274624611998,
        0.8813138461493795,
        0.24628213709130045,
        0.740086517565902,
        0.6718759583879124,
        0.819580145108679,
        0.5357018983442174,
        0.7295241851427642,
        1.0,
        0.6578614416074023,
        0.9264317495755221,
        0.7471890274263533,
        0.14000109190462226,
        0.6863806282961924,
        1.0,
        0.7637454762412845,
        0.07075221188550278,
        0.6831676799305523,
        0.9873087541633854,
        0.7673338167385968,
        0.17072857501327637,
        0.7549775862544512,
        0.9546609499055327,
        0.722199751619698,
        0.009705903983255056,
        0.7068370724657879,
        0.13366299456333128,
        0.006541066129985207,
        0.40338300265353866,
        0.000569386789807988,
        0.18273759101205395,
        0.4918391645370229,
        0.27697684421794416,
        0.4090156517000583,
        0.23421119140872498,
        0.9553504690595734,
        0.561566547222225,
        0.8959987269390371,
        0.20342940452489522,
        1.0,
        0.5844234388978824,
        0.9367448197570454,
        0.2958452481295931,
        0.9864829597242535,
        0.6347807395506637,
        0.9403880044391386,
    ],
    # move_right.png
    "move_right": [
        0.010920992256856834,
        0.9547697453369357,
        0.10948482896358756,
        0.9821575566308748,
        0.1212118312758112,
        0.9869683536751519,
        0.11334132243617935,
        0.9863999522695984,
        0.007278040246672584,
        1.0,
        0.015080456622135936,
        0.9979378863624625,
        0.03305875861995733,
        0.9777177387900343,
        0.5515032993210222,
        0.9558001342862791,
        0.06264607631187004,
        0.906939074279547,
        0.20087750347099012,
        0.9309133604161806,
        0.0041420703471698045,
        0.8838675695073973,
        0.9994245545230829,
        0.7234805080081996,
        0.19574670916131884,
        0.8408492093316497,
        0.7717832615538178,
        0.6295066493079983,
        0.5409207033505309,
        0.7539282298610653,
        0.12052827443141023,
        0.6900569380947377,
        0.9552201432181522,
        0.824994078224429,
        0.23134460406337817,
        0.7036793371885725,
        1.0,
        0.8453222425452415,
        0.2753366311560438,
        0.7257817188999923,
        0.9606452313104825,
        0.8859832907974717,
        0.1465540705058452,
        0.6768229273340255,
        0.9666830616517594,
        0.8415734469364384,
        0.4883370307084183,
        0.0025861248582447144,
        0.15043655758841526,
        0.003363398078450614,
        0.6635587183573567,
        0.4984876707650725,
        0.06834077014317846,
        0.41872463797585274,
        0.906051159164697,
        0.947025754825857,
        0.07138685356571646,
        0.9104160017838069,
        0.806635896010994,
        0.9871022184148116,
        0.07097395000553997,
        0.9504512406043913,
        1.0,
        1.0,
        0.17605428410940357,
        0.958219393621261,
    ],
    # quick_left.png
    "turn_on_left_quickly": [
        0.716849965869223,
        0.855981747202055,
        0.7066820384759575,
        0.9195475403161633,
        0.715193059755496,
        0.9212085696284804,
        0.7175432524463148,
        0.9230140102912509,
        0.7237933372355692,
        0.9251075764966842,
        0.7329012748664135,
        0.9224895481040184,
        0.7375620367818267,
        0.9030945061739338,
        0.4580435470993141,
        1.0,
        0.39627635374110043,
        0.8810078358594696,
        0.6584758316709125,
        0.8716811532829879,
        0.6261773711790654,
        0.7995645649204711,
        0.2528230685669607,
        0.7269066331818242,
        0.22931204232414873,
        0.8613332334737145,
        0.16627098347924807,
        0.3803443403996629,
        0.18134647155928516,
        0.4742707774569301,
        0.4617309283736776,
        0.039538632625691156,
        0.6580700013467016,
        0.3472942840393986,
        0.4852432367954592,
        0.019199258731558422,
        0.8469036949585385,
        0.35628530982011125,
        0.5400149444163008,
        0.02101269804024834,
        1.0,
        0.4337301790441801,
        0.5165909409009797,
        0.0008623072871225633,
        0.7329686099426279,
        0.37400570295362046,
        0.012315181656634788,
        0.005271001299836974,
        1.0,
        0.015881367494817625,
        0.23736617360405454,
        0.5275519398612001,
        0.2300544653082077,
        0.4537433689154947,
        0.31122648607851433,
        0.9625898311598846,
        0.0560552928513311,
        0.955587711900879,
        0.25950429637492434,
        1.0,
        0.05960366110901367,
        0.9994605340555571,
        0.5075958763800795,
        0.9952654821578752,
        0.3927422548945321,
        0.9587632403644634,
    ],
    # quick_right.png
    "turn_on_right_quickly": [
        0.9440666089175875,
        0.9281761752372281,
        0.8571739692174533,
        0.9721084669561537,
        0.8414697910925897,
        0.9695076321700816,
        0.8488540402530222,
        0.9731579936657627,
        0.8339438536095859,
        0.9934248580253054,
        0.8259148875678651,
        0.988978010585475,
        0.797815257101281,
        0.9716212105879213,
        0.39179680634054076,
        1.0,
        0.3633716662103229,
        0.9395171412662187,
        0.7067320160287541,
        0.9300144475956684,
        0.6821986946467258,
        0.8755070012882336,
        0.1274606383070603,
        0.8091357845606336,
        0.07623295684388444,
        0.8392712387731077,
        0.060672319843998124,
        0.5901834230204218,
        0.7604816833935675,
        0.387136412766824,
        0.7285261660050265,
        0.41657184804902037,
        0.03761627283382014,
        0.06629765405982789,
        0.9139784983885579,
        0.39237355869250934,
        0.2136526060928702,
        0.0028800656783766823,
        1.0,
        0.40163460703237364,
        0.059855571182032004,
        0.038794198878001195,
        0.7287531124162621,
        0.4020573609396222,
        0.06432254482964839,
        0.06633860117765249,
        0.012839630716931241,
        0.012832863158172362,
        0.08017884888142748,
        0.004692589341983417,
        0.1486486738836676,
        0.48178366358847724,
        0.01255590211227644,
        0.39902420394362653,
        1.0,
        0.9484686936415524,
        0.6775823907433718,
        0.8904487525758757,
        0.8362358312520484,
        1.0,
        0.7002105843862095,
        0.9317720167714165,
        0.3514476134854604,
        0.9876295083185426,
        0.35109403459482624,
        0.9281326365249899,
    ],
    # slow_left.png
    "turn_on_left_slowly": [
        0.23798333187011653,
        0.9446727689239184,
        0.28330087380919533,
        0.9737912149494943,
        0.29588136566504997,
        0.976852461351379,
        0.29043945888151707,
        0.9763018429181745,
        0.22134486292196634,
        1.0,
        0.2283166384773467,
        0.9965592916928558,
        0.2388590223442167,
        0.9788832349145544,
        0.31728925422526255,
        0.9507833922172798,
        0.1486913423546185,
        0.9212826754710044,
        0.2886418858207123,
        0.9285963778422154,
        0.1593987623425325,
        0.8849270899466969,
        0.39072323522613867,
        0.6679343182973214,
        0.4698588941179128,
        0.8491993199767213,
        0.43144972909585744,
        0.3563424094616851,
        1.0,
        0.4610405972592666,
        0.8885344569644044,
        0.2853666786237638,
        0.6349797404038859,
        0.3143863630741887,
        0.9534241289231381,
        0.2872589141608786,
        0.41158489827061623,
        0.2842080422547322,
        1.0,
        0.3005851578024227,
        0.1865087562200907,
        0.3547486785202907,
        0.9503991894376052,
        0.26676880939115666,
        0.521431204548755,
        0.33664876243138675,
        0.2533270638971854,
        0.010983251197616652,
        0.26528798263080544,
        0.019057764625977684,
        0.3259301467755778,
        0.4816386094726119,
        0.2761194126571729,
        0.3685018596462298,
        0.1415080532168971,
        0.9428995726642293,
        0.8363062404913084,
        0.8023861482008348,
        0.05143354561921843,
        0.9874993753117317,
        0.8846132791094258,
        0.837515326735412,
        0.409558083138188,
        1.0,
        0.6820387338371143,
        0.8702848284532523,
    ],
    # slow_right.png
    "turn_on_right_slowly": [
        0.4919199022777393,
        0.9512219385029936,
        0.40612312757164043,
        0.9861151958683212,
        0.3965098823313413,
        0.9872339535611934,
        0.40208815864248826,
        0.9868511115888262,
        0.4881830261617699,
        0.9951100039508839,
        0.4851255082862708,
        0.9921393989418715,
        0.45743050066907814,
        0.9712710259279349,
        0.009977706918871884,
        1.0,
        0.4794936973073535,
        0.8958279833742584,
        0.2652192207071734,
        0.949820476883184,
        0.37639001517426784,
        0.8831031037518702,
        0.41401794087628024,
        0.8012464219253899,
        0.42571206669006845,
        0.7780608375836265,
        1.0,
        0.5857787866735573,
        0.48000607908546317,
        0.36181894118194546,
        0.8497441103660265,
        0.3329012309160719,
        0.9816455144110456,
        0.36642154669287275,
        0.7852713736171134,
        0.280363117697718,
        1.0,
        0.3888593221549255,
        0.6423508979767076,
        0.2765019387969078,
        0.9749692213233782,
        0.4758891985244758,
        0.8125051001599656,
        0.3009469262707028,
        0.9990398627973496,
        0.4002665103897697,
        0.17641871072876827,
        0.0034725839070624733,
        0.19360052112286816,
        0.003028249297055414,
        0.09883963532460856,
        0.4483524981447334,
        0.22433973058084783,
        0.38563304494354217,
        0.2897242489591573,
        0.9097648537002571,
        0.14339647017469737,
        0.8675435409283112,
        0.25045481124999946,
        0.9602666992825346,
        0.1492296749065969,
        0.9108154241969807,
        0.22575184646509777,
        1.0,
        0.6098605627807151,
        0.928769526927639,
    ],
    # small_skill.png
    "E": [
        0.048104134510469514,
        0.9515680268294437,
        0.028777257030294733,
        0.9784623657811501,
        0.03723153159476894,
        0.9812514385589003,
        0.026930362668871884,
        0.9802580857683759,
        0.08291189041808697,
        1.0,
        0.07265471640009928,
        0.9963586551957664,
        0.05909656598277556,
        0.9778158800204401,
        0.27854120511223046,
        0.9427395208870688,
        0.3449790648706273,
        0.8792535565730069,
        0.10438017197064305,
        0.9275074472996458,
        0.060240552728642226,
        0.8744698086216192,
        0.6279531335413763,
        0.6807114132725215,
        0.5971636667215429,
        0.7889232055750716,
        1.0,
        0.5863308014696688,
        1.0,
        0.5767896336852667,
        0.5618977674966964,
        0.7258851987777681,
        0.4082219304777098,
        0.719947852299161,
        0.35486289796119824,
        0.7627771070037349,
        0.07629476483878794,
        0.760708475908396,
        0.2566685885490731,
        0.7894555079467275,
        0.08256731593930809,
        0.8342138784382862,
        0.5188561575203223,
        0.721232000343072,
        0.3124092766955282,
        0.7510253260369816,
        0.32101113946789817,
        0.0008714240277950927,
        0.37256145646437405,
        0.007741941828710306,
        0.4777709737785861,
        0.5131556818618294,
        0.30298509094545556,
        0.407564755775521,
        0.7281222033176975,
        0.9609393315407313,
        0.3792337542086839,
        0.8976025123915005,
        0.6740531673460189,
        1.0,
        0.3835821007777656,
        0.9361884473015741,
        0.9108901935804704,
        0.9914110335368185,
        0.5175312035241103,
        0.9349416116795304,
    ],
    # speed_up.png
    "run": [
        0.01984736841973123,
        0.6434059746908521,
        0.09442738307030754,
        0.6604326394290108,
        0.10110288979395629,
        0.6626971201281224,
        0.0937823509848257,
        0.6612087553199684,
        0.01037012010922466,
        0.6698231745402023,
        0.008158192315230704,
        0.6683440916502753,
        0.008469713395067276,
        0.6559554354820933,
        0.4761486676143596,
        0.6445480809203779,
        0.2756103493016821,
        0.5902632431919742,
        0.2477300854346357,
        0.6274663393694283,
        0.028791283308804122,
        0.5910811584497819,
        0.824508591417303,
        0.5371573320177188,
        0.5113576310873484,
        0.5251414893200467,
        0.9114963254721016,
        0.7251140246772397,
        0.7033026669693094,
        0.3157021964768174,
        0.9809621175564386,
        0.9299777621221391,
        0.6616638653648388,
        0.3399978940495466,
        0.9315849218739146,
        0.9841732229690717,
        0.4614660567858926,
        0.357812138769718,
        0.8582393130548468,
        1.0,
        0.3332692480419318,
        0.4153828062853216,
        1.0,
        0.9270019545506879,
        0.5947225283849392,
        0.367428236787758,
        0.46933383981846877,
        0.006456452429321399,
        0.4737411461339598,
        0.008657349052497484,
        0.5164875891893376,
        0.5001708990813798,
        0.6326181716527286,
        0.382925049299261,
        0.5186316565930356,
        0.9261037797481575,
        0.6718096926203684,
        0.8657663821613911,
        0.4013871683848832,
        0.9652411764306958,
        0.6686039194784704,
        0.9088954177495424,
        0.3912544528763786,
        1.0,
        1.0,
        0.9257830048850915,
    ],
    # ultra_skill.png
    "R": [
        0.26716521636011625,
        0.1681624211542161,
        0.28569859125826164,
        0.428044927336428,
        0.2835755832112268,
        0.388125093398448,
        0.2817528839058708,
        0.40566805533884537,
        0.2459132975074796,
        0.40157578194475874,
        0.24784350312836687,
        0.3572824952418516,
        0.242047854266154,
        0.2870753907225879,
        0.33799802170531934,
        0.762475694536259,
        0.05670573927559434,
        0.5650410139036101,
        0.31602469259192495,
        0.13922658111923922,
        0.21814719496018722,
        0.012367177854584906,
        0.4702859682866037,
        1.0,
        0.06376872697054589,
        0.9124080170368188,
        0.6493493996403137,
        0.04732792502779764,
        0.23511735647703774,
        0.210529148211599,
        0.6115582402140747,
        0.2823134963742552,
        0.1341769542551084,
        0.33568518399381836,
        0.6221874592854224,
        0.31818897346554664,
        0.20754045876368085,
        0.39108776902093934,
        0.5382530127052287,
        0.30112578907520765,
        0.34515146764835775,
        0.3595205755123785,
        0.5554967580041513,
        0.31487056721209,
        0.1892646825814683,
        0.3361989560743825,
        0.16600561561234625,
        0.24937945751557336,
        0.6591716285547805,
        0.04150043447233392,
        0.6887788095607793,
        0.24679424364913988,
        0.081300876490042,
        0.41871090121499743,
        0.7834611114184845,
        0.7993802743425024,
        0.9281461386296493,
        0.8885966306964126,
        0.7868308655217703,
        0.8323143640918477,
        1.0,
        0.928748728443134,
        1.0,
        0.8590504084320413,
        0.7436255564760876,
        1.0,
    ],
}


if __name__ == "__main__":
    # image_path = "E:/mingchao_data/human_pose_test/test/forward1.png"
    # image_path = "E:/mingchao_data/human_pose_test/test/slow_right0.png"
    image_path = "E:/mingchao_data/human_pose_test/test/jump0.png"

    model_path = "E:/python_projects/MingchaoPlayer/models/mediapipe_models/pose_landmarker_heavy.task"

    flatten_coords0 = []

    # STEP 2: Create an PoseLandmarker object.
    base_options = python.BaseOptions(model_asset_path=model_path)
    options = vision.PoseLandmarkerOptions(
        base_options=base_options, output_segmentation_masks=True
    )
    detector = vision.PoseLandmarker.create_from_options(options)

    # STEP 3: Load the input image.
    image = mp.Image.create_from_file(image_path)

    # STEP 4: Detect pose landmarks from the input image.
    detection_result = detector.detect(image)

    # print(f"pose result: {detection_result}")

    # 归一化worldLandmarks
    worldLandmarks = detection_result.pose_world_landmarks[0]
    max_x = 0
    min_x = 0
    max_y = 0
    min_y = 0
    for landmark in worldLandmarks:
        if landmark.x > max_x:
            max_x = landmark.x
        if landmark.x < min_x:
            min_x = landmark.x
        if landmark.y > max_y:
            max_y = landmark.y
        if landmark.y < min_y:
            min_y = landmark.y
    for landmark in worldLandmarks:
        if landmark.x > 0:
            temp_x = landmark.x / max_x
        elif landmark.x < 0:
            temp_x = landmark.x / min_x
        else:
            temp_x = 0
        if landmark.y > 0:
            temp_y = landmark.y / max_y
        elif landmark.y < 0:
            temp_y = landmark.y / min_y
        else:
            temp_y = 0
        # print(f"{temp_x}   {temp_y}")
        flatten_coords0.append(temp_x)
        flatten_coords0.append(temp_y)

    # 计算相似度
    min_L2_distance = 100000
    current_action = ""
    for key, value in HUMAN_POSE_STANDARD_EMBEDDINGS.items():
        L2_distance_temp = 0
        for i in range(len(flatten_coords0)):
            L2_distance_temp += (flatten_coords0[i] - value[i]) ** 2
        if L2_distance_temp < min_L2_distance:
            min_L2_distance = L2_distance_temp
            current_action = key

    print(f"current_action: {current_action}, L2_distance: {min_L2_distance}")
